# Release Process

This document describes how to create a new release of claude-yolo.

## Prerequisites

- Maintainer access to the repository
- All tests passing on main branch
- CHANGELOG.md updated with release notes
- Version number decided (following semantic versioning)

## Semantic Versioning

claude-yolo follows [Semantic Versioning](https://semver.org/):

- **MAJOR** version (v2.0.0): Incompatible API changes
- **MINOR** version (v2.1.0): New functionality (backwards compatible)
- **PATCH** version (v2.0.1): Bug fixes (backwards compatible)

Examples:
- Go rewrite: `v2.0.0` (breaking change from bash to Go binary)
- New --chrome flag: `v2.1.0` (new feature, backwards compatible)
- Bug fix: `v2.0.1` (backwards compatible fix)

## Release Checklist

### 1. Prepare Release

```bash
# Ensure you're on main and up to date
git checkout main
git pull origin main

# Run full test suite
make test-all

# Verify linting passes
make lint

# Verify build works
make build
./bin/claude-yolo --help
```

### 2. Update CHANGELOG.md

```bash
# Edit CHANGELOG.md
vim CHANGELOG.md
```

Add a new section for the release:

```markdown
## [2.0.0] - 2025-02-22

### Added
- Complete Go rewrite of claude-yolo
- Comprehensive test suite with 76.6% coverage
- ... (list all changes)

### Changed
- Binary is now compiled Go instead of bash script
- ... (list all changes)

### Fixed
- ... (list all bug fixes)

### Security
- Fixed trust file permissions from 0644 to 0600
- ... (list all security fixes)
```

### 3. Commit Changes

```bash
git add CHANGELOG.md
git commit -m "chore: Prepare release v2.0.0"
git push origin main
```

### 4. Create and Push Tag

```bash
# Create annotated tag
git tag -a v2.0.0 -m "Release v2.0.0"

# Push tag to trigger release workflow
git push origin v2.0.0
```

### 5. Monitor Release Workflow

```bash
# Watch GitHub Actions
gh run watch

# Or view in browser:
# https://github.com/rickgorman/claude-yolo/actions/workflows/release.yml
```

The workflow will:
1. Run tests
2. Build binaries for all platforms (Linux, macOS, amd64, arm64)
3. Create archives (tar.gz, zip)
4. Generate checksums
5. Create GitHub release with assets
6. Update Homebrew tap (if configured)

### 6. Verify Release

```bash
# Check GitHub releases page
gh release view v2.0.0

# Or in browser:
# https://github.com/rickgorman/claude-yolo/releases/tag/v2.0.0
```

Verify:
- [ ] Release notes are correct
- [ ] All platform binaries are attached
- [ ] Checksums file is present
- [ ] Archive includes README, LICENSE, strategies/
- [ ] Download and test one of the binaries

### 7. Announce Release

Create announcement in appropriate channels:
- GitHub Discussions
- Project README
- Social media (if applicable)

## Troubleshooting

### Release Workflow Failed

```bash
# Check workflow logs
gh run view --log-failed

# Common issues:
# 1. Tests failing - fix and retag
# 2. GoReleaser config error - fix .goreleaser.yml
# 3. Missing secrets - add HOMEBREW_TAP_GITHUB_TOKEN in repo settings
```

### Delete and Recreate Tag

If you need to recreate a tag (only before release is finalized):

```bash
# Delete local tag
git tag -d v2.0.0

# Delete remote tag
git push --delete origin v2.0.0

# Delete GitHub release (if created)
gh release delete v2.0.0

# Recreate tag
git tag -a v2.0.0 -m "Release v2.0.0"
git push origin v2.0.0
```

⚠️ **Warning**: Only delete tags/releases before users download them!

### Update Existing Release

If release is created but needs updates:

```bash
# Edit release notes
gh release edit v2.0.0 --notes "Updated release notes..."

# Upload additional asset
gh release upload v2.0.0 path/to/file
```

## Release Artifacts

Each release includes:

### Binaries
- `claude-yolo_2.0.0_Linux_x86_64.tar.gz`
- `claude-yolo_2.0.0_Linux_arm64.tar.gz`
- `claude-yolo_2.0.0_Darwin_x86_64.tar.gz` (macOS Intel)
- `claude-yolo_2.0.0_Darwin_arm64.tar.gz` (macOS Apple Silicon)

### Additional Files
- `checksums.txt` - SHA256 checksums for all binaries
- `CHANGELOG.md` - Full changelog
- Source code (auto-generated by GitHub)

### Archive Contents
Each archive includes:
- `claude-yolo` - Binary executable
- `README.md` - Documentation
- `LICENSE` - MIT license
- `CHANGELOG.md` - Version history
- `strategies/` - Docker strategy definitions
- `scripts/` - Helper scripts
- `examples/` - Configuration examples

## Homebrew Tap

Releases are automatically published to the Homebrew tap:
```bash
brew install rickgorman/tap/claude-yolo
```

This requires:
1. Create `homebrew-tap` repository: https://github.com/rickgorman/homebrew-tap
2. Add `HOMEBREW_TAP_GITHUB_TOKEN` secret in repository settings
3. Token needs `repo` scope to push to homebrew-tap

## Post-Release Tasks

After successful release:

1. **Update main branch**:
   ```bash
   # Update version in code if needed
   # Update README badges if version changed
   ```

2. **Close milestone** (if using GitHub milestones):
   ```bash
   gh api repos/rickgorman/claude-yolo/milestones/{milestone_number} \
     -X PATCH -f state=closed
   ```

3. **Monitor for issues**:
   - Watch for installation problems
   - Check GitHub issues for bug reports
   - Monitor Homebrew tap for installation failures

## Emergency Hotfix Release

For critical security or bug fixes:

```bash
# Create hotfix branch from tag
git checkout -b hotfix/v2.0.1 v2.0.0

# Make fixes
vim file.go
git add file.go
git commit -m "fix: Critical bug fix"

# Update CHANGELOG
vim CHANGELOG.md
git add CHANGELOG.md
git commit -m "chore: Update CHANGELOG for v2.0.1"

# Merge to main
git checkout main
git merge hotfix/v2.0.1

# Tag and release
git tag -a v2.0.1 -m "Release v2.0.1 - Critical bug fix"
git push origin main
git push origin v2.0.1

# Delete hotfix branch
git branch -d hotfix/v2.0.1
```

## Version File

The version is embedded at build time via ldflags:
```go
// cmd/claude-yolo/main.go
var version = "dev"  // Overridden by GoReleaser
```

No manual version file updates needed.
